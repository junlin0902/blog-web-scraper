"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("chevrotain"),t=require("lilconfig"),n=require("os");function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function a(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t.indexOf(n=a[r])>=0||(i[n]=e[n]);return i}var u=e.createToken({name:"Identifier",pattern:/[a-zA-Z][\w-]*/}),o=e.createToken({name:"Datasource",pattern:/datasource/,push_mode:"block"}),s=e.createToken({name:"Generator",pattern:/generator/,push_mode:"block"}),c=e.createToken({name:"Model",pattern:/model/,push_mode:"block"}),m=e.createToken({name:"View",pattern:/view/,push_mode:"block"}),l=e.createToken({name:"Enum",pattern:/enum/,push_mode:"block"}),p=e.createToken({name:"Type",pattern:/type/,push_mode:"block"}),f=e.createToken({name:"True",pattern:/true/,longer_alt:u}),d=e.createToken({name:"False",pattern:/false/,longer_alt:u}),y=e.createToken({name:"Null",pattern:/null/,longer_alt:u}),L=e.createToken({name:"Comment",pattern:e.Lexer.NA}),v=e.createToken({name:"DocComment",pattern:/\/\/\/[ \t]*(.*)/,categories:[L]}),h=e.createToken({name:"LineComment",pattern:/\/\/[ \t]*(.*)/,categories:[L]}),b=e.createToken({name:"Attribute",pattern:e.Lexer.NA}),E=e.createToken({name:"BlockAttribute",pattern:/@@/,label:"'@@'",categories:[b]}),g=e.createToken({name:"FieldAttribute",pattern:/@/,label:"'@'",categories:[b]}),A=e.createToken({name:"Dot",pattern:/\./,label:"'.'"}),U=e.createToken({name:"QuestionMark",pattern:/\?/,label:"'?'"}),k=e.createToken({name:"LCurly",pattern:/{/,label:"'{'"}),S=e.createToken({name:"RCurly",pattern:/}/,label:"'}'",pop_mode:!0}),O=e.createToken({name:"LRound",pattern:/\(/,label:"'('"}),N=e.createToken({name:"RRound",pattern:/\)/,label:"')'"}),B=e.createToken({name:"LSquare",pattern:/\[/,label:"'['"}),T=e.createToken({name:"RSquare",pattern:/\]/,label:"']'"}),C=e.createToken({name:"Comma",pattern:/,/,label:"','"}),w=e.createToken({name:"Colon",pattern:/:/,label:"':'"}),M=e.createToken({name:"Equals",pattern:/=/,label:"'='"}),j=e.createToken({name:"StringLiteral",pattern:/"(:?[^\\"\n\r]|\\(:?[bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/}),R=e.createToken({name:"NumberLiteral",pattern:/-?(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),_=e.createToken({name:"WhiteSpace",pattern:/\s+/,group:e.Lexer.SKIPPED}),x=e.createToken({name:"LineBreak",pattern:/\n|\r\n/,line_breaks:!0,label:"LineBreak"}),P=[L,v,h,x,_],D={modes:{global:[].concat(P,[o,s,c,m,l,p]),block:[].concat(P,[b,E,g,A,U,k,S,B,T,O,N,C,w,M,f,d,y,j,R,u])},defaultMode:"global"},I=new e.Lexer(D),V=["model","view","type"];function F(e,t){return null!=e&&"type"in e&&t.includes(e.type)}function Y(e){return F(e,V)}var q=["field","enumerator"];function G(e){return null!=e&&"type"in e&&q.includes(e.type)}function z(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.reduce((function(e,t){if(!t)return e;var n=e.endColumn,r=void 0===n?-Infinity:n,i=e.endLine,a=void 0===i?-Infinity:i,u=e.endOffset,o=void 0===u?-Infinity:u,s=e.startColumn,c=void 0===s?Infinity:s,m=e.startLine,l=e.startOffset,p=void 0===l?Infinity:l;return null!=t.startLine&&t.startLine<(void 0===m?Infinity:m)&&(e.startLine=t.startLine),null!=t.startColumn&&t.startColumn<c&&(e.startColumn=t.startColumn),null!=t.startOffset&&t.startOffset<p&&(e.startOffset=t.startOffset),null!=t.endLine&&t.endLine>a&&(e.endLine=t.endLine),null!=t.endColumn&&t.endColumn>r&&(e.endColumn=t.endColumn),null!=t.endOffset&&t.endOffset>o&&(e.endOffset=t.endOffset),e}),{});return Object.assign(e,{location:i})}var W,K={parser:{nodeLocationTracking:"none"}},Q=function(e){function t(t){var n;return(n=e.call(this,D,t)||this).config=void 0,n.break=n.RULE("break",(function(){n.CONSUME1(x),n.CONSUME2(x)})),n.keyedArg=n.RULE("keyedArg",(function(){n.CONSUME(u,{LABEL:"keyName"}),n.CONSUME(w),n.SUBRULE(n.value)})),n.array=n.RULE("array",(function(){n.CONSUME(B),n.MANY_SEP({SEP:C,DEF:function(){n.SUBRULE(n.value)}}),n.CONSUME(T)})),n.func=n.RULE("func",(function(){n.CONSUME(u,{LABEL:"funcName"}),n.CONSUME(O),n.MANY_SEP({SEP:C,DEF:function(){n.OR([{ALT:function(){return n.SUBRULE(n.keyedArg)}},{ALT:function(){return n.SUBRULE(n.value)}}])}}),n.CONSUME(N)})),n.value=n.RULE("value",(function(){n.OR([{ALT:function(){return n.CONSUME(j,{LABEL:"value"})}},{ALT:function(){return n.CONSUME(R,{LABEL:"value"})}},{ALT:function(){return n.SUBRULE(n.array,{LABEL:"value"})}},{ALT:function(){return n.SUBRULE(n.func,{LABEL:"value"})}},{ALT:function(){return n.CONSUME(f,{LABEL:"value"})}},{ALT:function(){return n.CONSUME(d,{LABEL:"value"})}},{ALT:function(){return n.CONSUME(y,{LABEL:"value"})}},{ALT:function(){return n.CONSUME(u,{LABEL:"value"})}}])})),n.property=n.RULE("property",(function(){n.CONSUME(u,{LABEL:"propertyName"}),n.CONSUME(M),n.SUBRULE(n.value,{LABEL:"propertyValue"})})),n.assignment=n.RULE("assignment",(function(){n.CONSUME(u,{LABEL:"assignmentName"}),n.CONSUME(M),n.SUBRULE(n.value,{LABEL:"assignmentValue"})})),n.field=n.RULE("field",(function(){n.CONSUME(u,{LABEL:"fieldName"}),n.SUBRULE(n.value,{LABEL:"fieldType"}),n.OPTION1((function(){n.OR([{ALT:function(){n.CONSUME(B,{LABEL:"array"}),n.CONSUME(T,{LABEL:"array"})}},{ALT:function(){return n.CONSUME(U,{LABEL:"optional"})}}])})),n.MANY((function(){n.SUBRULE(n.fieldAttribute,{LABEL:"attributeList"})})),n.OPTION2((function(){n.CONSUME(L,{LABEL:"comment"})}))})),n.block=n.RULE("block",(function(e){void 0===e&&(e={});var t=e.componentType,r="enum"===t,i="model"===t||"view"===t||"type"===t;n.CONSUME(k),n.CONSUME1(x),n.MANY((function(){n.OR([{ALT:function(){return n.SUBRULE(n.comment,{LABEL:"list"})}},{GATE:function(){return i},ALT:function(){return n.SUBRULE(n.property,{LABEL:"list"})}},{ALT:function(){return n.SUBRULE(n.blockAttribute,{LABEL:"list"})}},{GATE:function(){return i},ALT:function(){return n.SUBRULE(n.field,{LABEL:"list"})}},{GATE:function(){return r},ALT:function(){return n.SUBRULE(n.enum,{LABEL:"list"})}},{GATE:function(){return!i},ALT:function(){return n.SUBRULE(n.assignment,{LABEL:"list"})}},{ALT:function(){return n.SUBRULE(n.break,{LABEL:"list"})}},{ALT:function(){return n.CONSUME2(x)}}])})),n.CONSUME(S)})),n.enum=n.RULE("enum",(function(){n.CONSUME(u,{LABEL:"enumName"}),n.MANY((function(){n.SUBRULE(n.fieldAttribute,{LABEL:"attributeList"})})),n.OPTION((function(){n.CONSUME(L,{LABEL:"comment"})}))})),n.fieldAttribute=n.RULE("fieldAttribute",(function(){n.CONSUME(g,{LABEL:"fieldAttribute"}),n.OR([{ALT:function(){n.CONSUME1(u,{LABEL:"groupName"}),n.CONSUME(A),n.CONSUME2(u,{LABEL:"attributeName"})}},{ALT:function(){return n.CONSUME(u,{LABEL:"attributeName"})}}]),n.OPTION((function(){n.CONSUME(O),n.MANY_SEP({SEP:C,DEF:function(){n.SUBRULE(n.attributeArg)}}),n.CONSUME(N)}))})),n.blockAttribute=n.RULE("blockAttribute",(function(){n.CONSUME(E,{LABEL:"blockAttribute"}),n.OR([{ALT:function(){n.CONSUME1(u,{LABEL:"groupName"}),n.CONSUME(A),n.CONSUME2(u,{LABEL:"attributeName"})}},{ALT:function(){return n.CONSUME(u,{LABEL:"attributeName"})}}]),n.OPTION((function(){n.CONSUME(O),n.MANY_SEP({SEP:C,DEF:function(){n.SUBRULE(n.attributeArg)}}),n.CONSUME(N)}))})),n.attributeArg=n.RULE("attributeArg",(function(){n.OR([{ALT:function(){return n.SUBRULE(n.keyedArg,{LABEL:"value"})}},{ALT:function(){return n.SUBRULE(n.value,{LABEL:"value"})}}])})),n.component=n.RULE("component",(function(){var e=n.OR1([{ALT:function(){return n.CONSUME(o,{LABEL:"type"})}},{ALT:function(){return n.CONSUME(s,{LABEL:"type"})}},{ALT:function(){return n.CONSUME(c,{LABEL:"type"})}},{ALT:function(){return n.CONSUME(m,{LABEL:"type"})}},{ALT:function(){return n.CONSUME(l,{LABEL:"type"})}},{ALT:function(){return n.CONSUME(p,{LABEL:"type"})}}]);n.OR2([{ALT:function(){n.CONSUME1(u,{LABEL:"groupName"}),n.CONSUME(A),n.CONSUME2(u,{LABEL:"componentName"})}},{ALT:function(){return n.CONSUME(u,{LABEL:"componentName"})}}]),n.SUBRULE(n.block,{ARGS:[{componentType:e.image}]})})),n.comment=n.RULE("comment",(function(){n.CONSUME(L,{LABEL:"text"})})),n.schema=n.RULE("schema",(function(){n.MANY((function(){n.OR([{ALT:function(){return n.SUBRULE(n.comment,{LABEL:"list"})}},{ALT:function(){return n.SUBRULE(n.component,{LABEL:"list"})}},{ALT:function(){return n.SUBRULE(n.break,{LABEL:"list"})}},{ALT:function(){return n.CONSUME(x)}}])}))})),n.performSelfAnalysis(),n.config=t,n}return r(t,e),t}(e.CstParser),Z=new Q(function(){if(null!=W)return W;var e=t.lilconfigSync("prisma-ast").search();return W=Object.assign(K,null==e?void 0:e.config)}().parser),H=function(e){return function(t){function n(){var e;return(e=t.call(this)||this).validateVisitor(),e}r(n,t);var i=n.prototype;return i.schema=function(e){var t,n=this;return{type:"schema",list:(null==(t=e.list)?void 0:t.map((function(e){return n.visit([e])})))||[]}},i.component=function(e){var t=e.type[0],n=e.componentName[0],r=this.visit(e.block),i=function(){switch(t.image){case"datasource":return{type:"datasource",name:n.image,assignments:r};case"generator":return{type:"generator",name:n.image,assignments:r};case"model":return{type:"model",name:n.image,properties:r};case"view":return{type:"view",name:n.image,properties:r};case"enum":return{type:"enum",name:n.image,enumerators:r};case"type":return{type:"type",name:n.image,properties:r};default:throw new Error("Unexpected block type: "+t)}}();return this.maybeAppendLocationData(i,t,n)},i.break=function(){return{type:"break"}},i.comment=function(e){var t=e.text[0];return this.maybeAppendLocationData({type:"comment",text:t.image},t)},i.block=function(e){var t,n=this;return null==(t=e.list)?void 0:t.map((function(e){return n.visit([e])}))},i.assignment=function(e){var t=this.visit(e.assignmentValue),n=e.assignmentName[0];return this.maybeAppendLocationData({type:"assignment",key:n.image,value:t},n)},i.field=function(e){var t,n,r,i,a=this,u=this.visit(e.fieldType),o=e.fieldName[0],s=null==(t=e.attributeList)?void 0:t.map((function(e){return a.visit([e])})),c=null==(n=e.comment)||null==(n=n[0])?void 0:n.image;return this.maybeAppendLocationData({type:"field",name:o.image,fieldType:u,array:null!=e.array,optional:null!=e.optional,attributes:s,comment:c},o,null==(r=e.optional)?void 0:r[0],null==(i=e.array)?void 0:i[0])},i.fieldAttribute=function(e){var t,n=this,r=e.attributeName[0],i=(e.groupName||[{}])[0],a=null==(t=e.attributeArg)?void 0:t.map((function(e){return n.visit(e)}));return this.maybeAppendLocationData.apply(this,[{type:"attribute",name:r.image,kind:"field",group:i.image,args:a},r].concat(e.fieldAttribute,[i]))},i.blockAttribute=function(e){var t,n=this,r=e.attributeName[0],i=(e.groupName||[{}])[0],a=null==(t=e.attributeArg)?void 0:t.map((function(e){return n.visit(e)}));return this.maybeAppendLocationData.apply(this,[{type:"attribute",name:r.image,kind:"object",group:i.image,args:a},r].concat(e.blockAttribute,[i]))},i.attributeArg=function(e){return{type:"attributeArgument",value:this.visit(e.value)}},i.func=function(e){var t,n,r=this,i=e.funcName[0],a=null==(t=e.value)?void 0:t.map((function(e){return r.visit([e])})),u=null==(n=e.keyedArg)?void 0:n.map((function(e){return r.visit([e])})),o=(a||u)&&[].concat(null!=a?a:[],null!=u?u:[]);return this.maybeAppendLocationData({type:"function",name:i.image,params:o},i)},i.array=function(e){var t,n=this;return{type:"array",args:null==(t=e.value)?void 0:t.map((function(e){return n.visit([e])}))}},i.keyedArg=function(e){var t=e.keyName[0],n=this.visit(e.value);return this.maybeAppendLocationData({type:"keyValue",key:t.image,value:n},t)},i.value=function(e){return"image"in e.value[0]?e.value[0].image:this.visit(e.value)},i.enum=function(e){var t,n,r=this,i=e.enumName[0],a=null==(t=e.attributeList)?void 0:t.map((function(e){return r.visit([e])})),u=null==(n=e.comment)||null==(n=n[0])?void 0:n.image;return this.maybeAppendLocationData({type:"enumerator",name:i.image,attributes:a,comment:u},i)},i.maybeAppendLocationData=function(t){if("none"===e.config.nodeLocationTracking)return t;for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return z.apply(void 0,[t].concat(r))},n}(e.getBaseCstVisitorConstructorWithDefaults())},J=new(H(Z));function X(e,t){var n,r,i=I.tokenize(e),a=null!=(n=null==t?void 0:t.parser)?n:Z;a.input=i.tokens;var u=a.schema();if(a.errors.length>0)throw a.errors[0];return(null!=(r=null==t?void 0:t.visitor)?r:J).visit(u)}var $=["break","comment"],ee=["generator","datasource","model","view","enum","break","comment"];function te(e,t){void 0===t&&(t={});var r=t.sort,i=t.locales,a=void 0===i?void 0:i,u=t.sortOrder,o=void 0===u?void 0:u,s=e.list;if(void 0!==r&&r){s=e.list=s.filter((function(e){return"break"!==e.type}));var c=function(e,t,n){return void 0===n&&(n=ee),function(r,i){if(-1!==$.indexOf(r.type)!=(-1!==$.indexOf(i.type)))return e.list.indexOf(r)-e.list.indexOf(i);n!==ee&&(n=n.concat(ee));var a=n.indexOf(r.type)-n.indexOf(i.type);return 0!==a?a:"name"in r&&"name"in i?r.name.localeCompare(i.name,t):0}}(e,a,o);s.sort(c)}return s.map(ne).filter(Boolean).join(n.EOL).replace(/(\r?\n\s*){3,}/g,n.EOL+n.EOL)+n.EOL}function ne(e){switch(e.type){case"comment":return re(e);case"datasource":return r=le((t=e).assignments),"\ndatasource "+t.name+" {\n  "+r+"\n}";case"enum":return function(e){var t=e.enumerators.filter(Boolean).map(ae).join(n.EOL+"  ").replace(/(\r?\n\s*){3,}/g,n.EOL+n.EOL+"  ");return"\nenum "+e.name+" {\n  "+t+"\n}"}(e);case"generator":return function(e){var t=le(e.assignments);return"\ngenerator "+e.name+" {\n  "+t+"\n}"}(e);case"model":case"view":case"type":return function(e){var t,r=[].concat(e.properties),i=!1;r.sort((function(e,t){return"attribute"===e.type&&"object"===e.kind&&("attribute"!==t.type||"attribute"===t.type&&"object"!==t.kind)?(i=!0,1):"attribute"===t.type&&"object"===t.kind&&("attribute"!==e.type||"attribute"===e.type&&"object"!==e.kind)?(i=!0,-1):0}));var a=r.findIndex((function(e){return"attribute"===e.type&&"object"===e.kind})),u=!["break","comment"].includes(null==(t=r[a-1])?void 0:t.type);i&&u&&r.splice(a,0,{type:"break"});var o,s,c,m,l,p=(s=0,c=(o=r).reduce((function(e,t,n,r){return"break"===t.type||(n>0&&"break"===r[n-1].type&&(e[++s]=[]),e[s].push(t)),e}),[[]]),m=c.map((function(e){return e.reduce((function(e,t){return Math.max(e,"field"===t.type?t.name.length:0)}),0)})),l=c.map((function(e){return e.reduce((function(e,t){return Math.max(e,"field"===t.type?se(t).length:0)}),0)})),o.map((function(e,t,n){return t>0&&"break"!==e.type&&"break"===n[t-1].type&&(m.shift(),l.shift()),function(e,t,n){switch(void 0===t&&(t=0),void 0===n&&(n=0),e.type){case"attribute":return ue(e);case"field":return function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=0);var r=e.name.padEnd(t),i=se(e).padEnd(n),a=e.attributes?e.attributes.map(ue):[],u=e.comment;return[r,i].concat(a).filter(Boolean).join(" ").trim()+(u?" "+u:"")}(e,t,n);case"comment":return re(e);case"break":return ie();default:throw new Error("Unrecognized property type")}}(e,m[0],l[0])})).filter(Boolean).join(n.EOL+"  ").replace(/(\r?\n\s*){3,}/g,n.EOL+n.EOL+"  "));return"\n"+e.type+" "+e.name+" {\n  "+p+"\n}"}(e);case"break":return ie();default:throw new Error("Unrecognized block type")}var t,r}function re(e){return e.text}function ie(){return n.EOL}function ae(e){switch(e.type){case"enumerator":var t=e.attributes?e.attributes.map(ue):[];return[e.name].concat(t,[e.comment]).filter(Boolean).join(" ");case"attribute":return ue(e);case"comment":return re(e);case"break":return ie();default:throw new Error("Unexpected enumerator type")}}function ue(e){var t=e.args&&e.args.length>0?"("+e.args.map(oe).filter(Boolean).join(", ")+")":"",n=[e.name];return e.group&&n.unshift(e.group),("field"===e.kind?"@":"@@")+n.join(".")+t}function oe(e){return me(e.value)}function se(e){var t=e.array?"[]":e.optional?"?":"";if("object"==typeof e.fieldType){if("function"===e.fieldType.type)return""+ce(e.fieldType)+t;throw new Error("Unexpected field type")}return""+e.fieldType+t}function ce(e){var t=e.params?e.params.map(me):"";return e.name+"("+t+")"}function me(e){if("object"==typeof e){if("type"in e)switch(e.type){case"keyValue":return e.key+": "+me(e.value);case"function":return ce(e);case"array":return"["+(null!=e.args?e.args.map(me).join(", "):"")+"]";default:throw new Error("Unexpected value type")}throw new Error("Unexpected object value")}return String(e)}function le(e){var t=0,r=e.reduce((function(e,n,r,i){return"break"===n.type||(r>0&&"break"===i[r-1].type&&(e[++t]=[]),e[t].push(n)),e}),[[]]).map((function(e){return e.reduce((function(e,t){return Math.max(e,"assignment"===t.type?t.key.length:0)}),0)}));return e.map((function(e,t,n){return t>0&&"break"!==e.type&&"break"===n[t-1].type&&r.shift(),function(e,t){switch(void 0===t&&(t=0),e.type){case"comment":return re(e);case"break":return ie();case"assignment":return e.key.padEnd(t)+" = "+me(e.value);default:throw new Error("Unexpected assignment type")}}(e,r[0])})).filter(Boolean).join(n.EOL+"  ").replace(/(\r?\n\s*){3,}/g,n.EOL+n.EOL+"  ")}var pe=function(e,t){var n=(void 0===t?{}:t).name;return function(t){if(null!=n){var r="assignment"===e?"key":"name";if(!(r in t))return!1;if(!("string"==typeof n?t[r]===n:n.test(t[r])))return!1}return t.type===e}},fe=["within"],de=["within"],ye=function(){function e(e){void 0===e&&(e=""),this.schema=void 0,this._subject=void 0,this._parent=void 0,this.schema=X(e)}var t=e.prototype;return t.print=function(e){return void 0===e&&(e={}),te(this.schema,e)},t.getSchema=function(){return this.schema},t.generator=function(e,t){void 0===t&&(t="prisma-client-js");var n=this.schema.list.reduce((function(t,n){return"generator"===n.type&&n.name===e?n:t}),{type:"generator",name:e,assignments:[{type:"assignment",key:"provider",value:'"'+t+'"'}]});return this.schema.list.includes(n)||this.schema.list.push(n),this._subject=n,this},t.drop=function(e){var t=this.schema.list.findIndex((function(t){return"name"in t&&t.name===e}));return-1!==t&&this.schema.list.splice(t,1),this},t.datasource=function(e,t){var n={type:"datasource",name:"db",assignments:[{type:"assignment",key:"url",value:"string"==typeof t?'"'+t+'"':{type:"function",name:"env",params:['"'+t.env+'"']}},{type:"assignment",key:"provider",value:e}]},r=this.schema.list.findIndex((function(e){return"datasource"===e.type}));return this.schema.list.splice(r,-1!==r?1:0,n),this._subject=n,this},t.model=function(e){var t=this.schema.list.reduce((function(t,n){return"model"===n.type&&n.name===e?n:t}),{type:"model",name:e,properties:[]});return this.schema.list.includes(t)||this.schema.list.push(t),this._subject=t,this},t.view=function(e){var t=this.schema.list.reduce((function(t,n){return"view"===n.type&&n.name===e?n:t}),{type:"view",name:e,properties:[]});return this.schema.list.includes(t)||this.schema.list.push(t),this._subject=t,this},t.type=function(e){var t=this.schema.list.reduce((function(t,n){return"type"===n.type&&n.name===e?n:t}),{type:"type",name:e,properties:[]});return this.schema.list.includes(t)||this.schema.list.push(t),this._subject=t,this},t.enum=function(e,t){void 0===t&&(t=[]);var n=this.schema.list.reduce((function(t,n){return"enum"===n.type&&n.name===e?n:t}),{type:"enum",name:e,enumerators:t.map((function(e){return{type:"enumerator",name:e}}))});return this.schema.list.includes(n)||this.schema.list.push(n),this._subject=n,this},t.enumerator=function(e){var t=this.getSubject();if(!t||!("type"in t)||"enum"!==t.type)throw new Error("Subject must be a prisma enum!");var n={type:"enumerator",name:e};return t.enumerators.push(n),this._parent=this._subject,this._subject=n,this},t.getSubject=function(){return this._subject},t.getParent=function(){return this._parent},t.blockAttribute=function(e,t){var n=this.getSubject();if("enum"!==n.type&&!Y(n)){var r=this.getParent();if(!F(r,["model","view","type","enum"]))throw new Error("Subject must be a prisma model, view, or type!");n=this._subject=r}var i={type:"attribute",kind:"object",name:e,args:t?"string"==typeof t?[{type:"attributeArgument",value:'"'+t+'"'}]:Array.isArray(t)?[{type:"attributeArgument",value:{type:"array",args:t}}]:Object.entries(t).map((function(e){return{type:"attributeArgument",value:{type:"keyValue",key:e[0],value:e[1]}}})):[]};return"enum"===n.type?n.enumerators.push(i):n.properties.push(i),this},t.attribute=function(e,t){var n=this.getParent(),r=this.getSubject();if(!F(n,["model","view","type","enum"]))throw new Error("Parent must be a prisma model or view!");if(!G(r))throw new Error("Subject must be a prisma field or enumerator!");r.attributes||(r.attributes=[]);var i=r.attributes.reduce((function(t,n){return"attribute"===n.type&&(n.group?n.group+".":"")+n.name===e?n:t}),{type:"attribute",kind:"field",name:e});if(Array.isArray(t)){var a=function e(t){var n,r;return"string"==typeof t?t:{type:"function",name:t.name,params:null!=(n=null==(r=t.function)?void 0:r.map(e))?n:[]}};t.length>0&&(i.args=t.map((function(e){return{type:"attributeArgument",value:a(e)}})))}else"object"==typeof t&&(i.args=Object.entries(t).map((function(e){return{type:"attributeArgument",value:{type:"keyValue",key:e[0],value:{type:"array",args:e[1]}}}})));return r.attributes.includes(i)||r.attributes.push(i),this},t.removeAttribute=function(e){var t=this.getParent(),n=this.getSubject();if(!Y(t))throw new Error("Parent must be a prisma model or view!");if(!G(n))throw new Error("Subject must be a prisma field!");return n.attributes||(n.attributes=[]),n.attributes=n.attributes.filter((function(t){return!("attribute"===t.type&&t.name===e)})),this},t.assignment=function(e,t){var n=this.getSubject();if(!n||!("type"in n)||!["generator","datasource"].includes(n.type))throw new Error("Subject must be a prisma generator or datasource!");var r=n.assignments.reduce((function(n,r){return"assignment"===r.type&&r.key===e?function(e,n){return e.value='"'+t+'"',e}(r):n}),{type:"assignment",key:e,value:'"'+t+'"'});return n.assignments.includes(r)||n.assignments.push(r),this},t.findByType=function(e,t){var n=t.within;return function(e,t,n){void 0===n&&(n={});var r=e.filter(pe(t,n)),i=r[0];if(!i)return null;if(r[1])throw new Error("Found multiple blocks with [type="+t+"]");return i}(void 0===n?this.schema.list:n,e,a(t,fe))},t.findAllByType=function(e,t){var n=t.within;return function(e,t,n){return void 0===n&&(n={}),e.filter(pe(t,n))}(void 0===n?this.schema.list:n,e,a(t,de))},t.blockInsert=function(e){var t=this.getSubject(),n=["datasource","enum","generator","model","view","type"];if(!t||!("type"in t)||!n.includes(t.type)){var r=this.getParent();if(!r||!("type"in r)||!n.includes(r.type))throw new Error("Subject must be a prisma block!");t=this._subject=r}switch(t.type){case"datasource":case"generator":t.assignments.push(e);break;case"enum":t.enumerators.push(e);break;case"model":t.properties.push(e)}return this},t.break=function(){return this.blockInsert({type:"break"})},t.comment=function(e,t){return void 0===t&&(t=!1),this.blockInsert({type:"comment",text:"//"+(t?"/":"")+" "+e})},t.schemaComment=function(e,t){return void 0===t&&(t=!1),this.schema.list.push({type:"comment",text:"//"+(t?"/":"")+" "+e}),this},t.field=function(e,t){void 0===t&&(t="String");var n=this.getSubject();if(!Y(n)){var r=this.getParent();if(!Y(r))throw new Error("Subject must be a prisma model or view or composite type!");n=this._subject=r}var i=n.properties.reduce((function(t,n){return"field"===n.type&&n.name===e?n:t}),{type:"field",name:e,fieldType:t});return n.properties.includes(i)||n.properties.push(i),this._parent=n,this._subject=i,this},t.removeField=function(e){var t=this.getSubject();if(!Y(t)){var n=this.getParent();if(!Y(n))throw new Error("Subject must be a prisma model or view or composite type!");t=this._subject=n}return t.properties=t.properties.filter((function(t){return!("field"===t.type&&t.name===e)})),this},t.then=function(e){return e(this._subject),this},e}();function Le(e){return new ye(e)}exports.ConcretePrismaSchemaBuilder=ye,exports.PrismaParser=Q,exports.VisitorClassFactory=H,exports.createPrismaSchemaBuilder=Le,exports.getSchema=X,exports.printSchema=te,exports.produceSchema=function(e,t,n){void 0===n&&(n={});var r=Le(e);return t(r),r.print(n)};
//# sourceMappingURL=prisma-ast.cjs.production.min.js.map
